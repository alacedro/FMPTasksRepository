<h1>FMP2 Features</h1>
<div id="content"></div>

<server-list (onServerChanged)="serverChanged($event)"></server-list>
<p-confirmDialog></p-confirmDialog>

<p *ngIf="features.length < 1"><em>No features available</em></p>

<div>
    <label>Features list: </label>
    <p-dropdown [options]="features" [(ngModel)]="selectedFeature" optionLabel="name" (onChange)="loadFeatureInfo($event.value.featureId)" [autoWidth]="false"></p-dropdown>    
</div>



<div>
    <p>
        Active: <span *ngIf="activeFeature;else inactive_feature" class='fa fa-check'></span>
        <ng-template #inactive_feature><span class='fa fa-times'></span></ng-template>
    </p>
</div>

<p-tabView>
    <p-tabPanel header="Clients">
        <label>Client list: </label>
        <div style="max-height:300px; min-height:300px; overflow:auto" class="card bg-faded">
            <table class='table table-striped table-bordered table-hover table-condensed table-fixed' *ngIf="featureClients" id="featureClientTable">
                <thead>
                    <tr>
                        <th class="col-8">Client</th>
                        <th class="col-3">Active</th>
                        <th class="col-3">Action</th>
                        <th class="col-1"></th>
                        <th class="col-1"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let featureClient of featureClients">
                        <td class="col-8">{{ featureClient.companyName }}</td>
                        <td class="col-3">
                            <span *ngIf="featureClient.active;else inactive_feature" class='fa fa-check'></span>
                            <ng-template #inactive_feature><span class='fa fa-times'></span></ng-template>
                        </td>
                        <td class="col-3">
                            <span *ngIf="featureClient.active;else inactive_feature_button">
                                <p-button (onClick)="deactivateFeatureForClient(featureClient.clientId)" label="Deactivate"></p-button>
                            </span>
                            <ng-template #inactive_feature_button><span><p-button (onClick)="activateFeatureForClient(featureClient.clientId)" label="Activate"></p-button></span></ng-template>
                        </td>
                        <td class="col-1">
                            <p-button (onClick)="confirmRemoveClientFromFeature(featureClient.clientId)" icon="fa fa-trash"></p-button>
                        </td>
                        <td class="col-1">
                            <p-button (onClick)="showEditAttribPopUp(featureClient.featureId, featureClient.clientId)" label="Config"></p-button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <br />

        <p-button (onClick)="showAddClientPopUp()" label="Add client"></p-button>
    </p-tabPanel>


    <p-tabPanel header="Flags">
        <label>Flag list: </label>
        <div style="max-height:300px; min-height:300px; overflow:auto" class="card bg-faded">
            <table class='table table-striped table-bordered table-hover table-condensed table-fixed' *ngIf="featureClients" id="featureClientTable">
                <thead>
                    <tr>
                        <th class="col-8">Flag Name</th>
                        <th class="col-3">Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let featureFlag of featureFlags">
                        <td class="col-8">{{ featureFlag.flagName }}</td>
                        <td class="col-3"><input type="text" pInputText value="{{ featureFlag.flagValue }}" [(ngModel)]="featureFlag.flagValue" (ngModelChange)="updateFeatureFlag(featureFlag)" /> </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <br />
        <p-button (onClick)="saveFeatureFlags()" label="Save" [disabled]="featureFlagsToUpdate.length < 1"></p-button>
    </p-tabPanel>


</p-tabView>


<br />
<br />
<br />




<p-dialog [(visible)]="addClientPopUpVisible" autoAlign="false">
    <p-header>
        <h4>Add client to feature</h4>
    </p-header>
    <label>Available client list: </label>
    <p *ngIf="availableClients.length < 1"><em>No clients available</em></p>
    <select *ngIf="availableClients.length >= 1" (change)="changeSelectedAvailableClientId($event.target.value)">
        <option *ngFor="let client of availableClients" value={{client.clientId}}>
            {{client.companyName}}
        </option>
    </select>
    <p-footer>
        <p-button (onClick)="addClientToFeature()" label="Add"></p-button>
        <p-button (onClick)="hideAddClientPopUp()" label="Cancel"></p-button>
    </p-footer>
</p-dialog>

<p-dialog [(visible)]="editAttribPopUpVisible" autoAlign="false" width ="500" (onHide)="hideEditAttribPopUp()">
    <p-header>
        <h4>Feature Configuration Attributes</h4>
    </p-header>
    <label>Attributes list: </label>
    <p *ngIf="clientConfigurationAttributes.length < 1"><em>No attributes available</em></p>
    
    <table *ngIf="clientConfigurationAttributes.length > 0" class='table table-striped table-bordered table-hover table-condensed table-fixed' id="featureClientTable">
        <thead>
            <tr>
                <th class="col-5">Attribute Description</th>
                <th class="col-6">Value</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let configAttrib of clientConfigurationAttributes">
                <td class="col-8">{{ configAttrib.description }}</td>
                <td class="col-3"><input type="text" pInputText value="{{ configAttrib.value }}" [(ngModel)]="configAttrib.value" /> </td>
            </tr>
        </tbody>
    </table>    
    <p-footer>
        <!--<p-button (onClick)="addClientToFeature()" label="Add"></p-button>-->
        <p-button (onClick)="hideEditAttribPopUp()" label="Cancel"></p-button>
    </p-footer>
</p-dialog>



